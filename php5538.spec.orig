Name:       php
Version:    5.5.38
Release:    1
Vendor:     php.net
Summary:    GUN php X86_64
License:    GPL
Source:     php-5.5.38.tar.gz
Group:      System Enviroment/Daemons
URL:        http://php.net
Packager:   gk.wl@qq.com
%description
php rpm package

%if 0%{?fedora} < 14 && 0%{?rhel} < 5
%global with_libgd   0
%else
%global with_libgd   1
%endif

%if 0%{?fedora} >= 11 || 0%{?rhel} >= 6
%global with_sqlite3  1
%else
%global with_sqlite3  0
%endif

%if 0%{?fedora} >= 17 || 0%{?rhel} >= 7
%global with_libpcre  1
%else
%global with_libpcre  0
%endif

%if 0%{?fedora} < 17 && 0%{?rhel} < 7
%global with_libzip  0
%else
%global with_libzip  1
%endif

%if 0%{?fedora} >= 12 || 0%{?rhel} >= 6
%global with_dtrace 1
%else
%global with_dtrace 0
%endif

%package gd
Summary: A module for PHP applications for using the gd graphics library
Group: Development/Languages
# All files licensed under PHP version 3.01
%if %{with_libgd}
License: PHP
%else
# bundled libgd is licensed under BSD
License: PHP and BSD
%endif
Requires: php-common%{?_isa} = %{version}-%{release}
BuildRequires: t1lib-devel
%if %{with_libgd}
BuildRequires: gd-devel >= 2.1.1
%if 0%{?fedora} <= 19 && 0%{?rhel} <= 7
Requires: gd-last%{?_isa} >= 2.1.1
%else
Requires: gd%{?_isa} >= 2.1.1
%endif
%else
# Required to build the bundled GD library
BuildRequires: libjpeg-devel
BuildRequires: libpng-devel
BuildRequires: freetype-devel
BuildRequires: libXpm-devel
%if %{with_vpx}
BuildRequires: libvpx-devel
%endif
%endif

Obsoletes: php53-gd, php53u-gd, php54-gd, php54w-gd, php55u-gd, php55w-gd

%description gd
The php-gd package contains a dynamic shared object that will add
support for using the gd graphics library to PHP.

BuildRequires: bzip2-devel, curl-devel >= 7.9
BuildRequires: httpd-devel >= 2.0.46-1, pam-devel
BuildRequires: libstdc++-devel, openssl-devel
%if %{with_sqlite3}
# For Sqlite3 extension
BuildRequires: sqlite-devel >= 3.6.0
%else
BuildRequires: sqlite-devel >= 3.0.0
%endif
BuildRequires: zlib-devel, smtpdaemon, libedit-devel
%if %{with_libpcre}
BuildRequires: pcre-devel >= 8.20
%endif
BuildRequires: bzip2, perl, libtool >= 1.4.3, gcc-c++
BuildRequires: libtool-ltdl-devel
%if %{with_libzip}
BuildRequires: libzip-devel >= 0.10
%endif
%if %{with_dtrace}
BuildRequires: systemtap-sdt-devel
%endif

%prep
%setup -q
--with-config-file-path=/usr/local/php/etc \
--with-curl \
--with-gd=/usr/local/libgd \
--with-gettext \
--with-iconv \
--with-libxml-dir=/usr \
--with-mcrypt  \
--with-mhash \
--with-mysqli=mysqlnd \
--with-mysql=mysqlnd \
--with-openssl \
--without-pear \
--with-pdo-mysql=mysqlnd \
--with-xmlrpc \
--with-zlib \
--disable-debug \
--disable-fileinfo
--disable-ipv6 \
--disable-maintainer-zts \
--enable-bcmath \
--enable-calendar \
--enable-fpm \
--enable-ftp \
--enable-gd-jis-conv \
--enable-gd-native-ttf \
--enable-inline-optimization \
--enable-mbregex \
--enable-mbstring \
--enable-opcache \
--enable-pcntl \
--enable-shmop \
--enable-soap \
--enable-sockets \
--enable-static \
--enable-sysvsem \
--enable-wddx \
--enable-xml \
--enable-zip

make -j4
%install
make DESTDIR=$RPM_BUILD_ROOT install
%clean
[ "$RPM_BUILD_ROOT" != "/" ] && rm -rf "$RPM_BUILD_ROOT"
make clean
%files
%defattr (-,root,root)
/usr/local/php/

